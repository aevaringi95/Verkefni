---
title: "Final Project"
author: "Rakel María Brynjólfsdóttir"
date: "March 23, 2018"
output:
  prettydoc::html_pretty:
    theme: cayman
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
```

```{r}
library(plyr); library(dplyr); library(lubridate)
library(ggplot2)
library(grid)
library(gridExtra)
```


```{r}
data = read.csv("gagnasafn_ibudarhusnaedi.csv",
                header  = T,
                sep = ";",
                dec = ",")


```


###Data preprocessing

We start by removing all the data which is not in the capital region. 

```{r}
capitalArea = c(0000,1000,1100,1300,1400,1604,1606)
data = data[data$svfn %in% capitalArea,]
```

Now we are going to remove the variables that we won't be using
```{r}
names(data)
delete = names(data)[c(1,2,5,6,7,10,11,12,13,14,15,17,18,19,20,21,
                       25,26,37,38,40,41,42,43,44,47,50,52,53)]
data = data[,-which(names(data) %in% delete)]
```


Change some variables to factors.
```{r}
str(data)
data$svfn = as.factor(data$svfn)
data$lyfta[which(data$lyfta != 0)] = 1
data$lyfta = as.factor(data$lyfta)
data$fjsturt[which(!(data$fjsturt %in% c(0,1)))] = 2
data$fjsturt = as.factor(data$fjsturt)
data$fjklos[which(!(data$fjklos %in% c(0,1)))] = 2
data$fjklos = as.factor(data$fjklos)
data$fjbkar[which(!(data$fjbkar %in% c(0,1)))] = 2
data$fjbkar = as.factor(data$fjbkar)
data$fjeld[which(!(data$fjeld %in% c(0,1)))] = 2
data$fjeld = as.factor(data$fjeld)
data$fjstof[which(!(data$fjstof %in% c(0,1)))] = 2
data$fjstof = as.factor(data$fjstof)
data$fjbilsk[which(data$fjbilsk != 0)] = 1
data$fjbilsk = as.factor(data$fjbilsk)
data$fjhaed = as.factor(data$fjhaed)
data$fjherb[which(!(data$fjherb %in% c(0,1,2,3,4,5)))] = 6
data$fjherb = as.factor(data$fjherb)
data$svalm2 = as.numeric(data$svalm2)
data$matssvaedi = as.factor(data$matssvaedi)
data$undirmatssvaedi = as.factor(data$undirmatssvaedi)
data$fjmib = as.factor(data$fjmib)
data$ibteg = as.factor(data$ibteg)
cor(data$ibm2,data$ntm2) #Highly correlated 
data$ntm2 = NULL #Throw out ntm2
data$svfn = revalue(data$svfn, c("0"="Rvk","1000"="Kop","1100"="Sel","1300"="Grb","1400"="Hfj","1604"="Mos","1606"="Kjh"))
```



Working with kdagur variable. Change it into days since the property was last bought. (Veit ekki alveg hvort við eigum að hafa þetta bara arið eða daga fjöldan. )

```{r}
data$kdagur <- strptime(x = as.character(data$kdagur),
                                format = "%d.%m.%Y")
mydate <- as.Date("2018-04-01")
data$kdagur <- as.Date(data$kdagur)
data$kdagur <- as.numeric(mydate-data$kdagur)
str(data)
```

Change byggar to how old the house is.
```{r}
data$byggar <- 2018 - as.numeric(as.character(data$byggar))
colnames(data)[5] = "aldur"
```


There are some observations with nuvirdi as 0. Take a closer look at them. Throw them out.
```{r}
noNuvirdi <- which(data$nuvirdi==0)
data = data[-noNuvirdi,]
```

Check for NA values. 

```{r}
dim(data)
dim(na.omit(data))
```

Correlation between variables.
```{r}
cor(log(data$nuvirdi),log(data$svalm2))
cor(log(data$nuvirdi),data$kdagur)
```

### Descriptive plots of the data


Here we look at the density of the Nuvirdi function. When we log scale it it looks a lot more like normal density.
```{r}
density1 <- ggplot(data,aes(nuvirdi))+
  geom_density()


density2 <- ggplot(data,aes(log(nuvirdi)))+
  geom_density()

grid.arrange(density1,density2,nrow=2)
```

Plotting Nuvirdi against some variables. (skoda fleiri)

```{r}
p1 <- ggplot(data, aes(x=kdagur,y=log(nuvirdi))) +
          geom_point()+
          theme_grey()

p2 <- ggplot(data, aes(x=stig10,y=nuvirdi)) +
          geom_point() +
          theme_grey()


grid.arrange(p1,p2,
             nrow=1)
```


Plot against fjoldi variables. (Breyta nöfnum a asum)
```{r}

f1 <- ggplot(data,aes(x=fjbilsk,y=log(nuvirdi)))+
          geom_boxplot()

f2 <- ggplot(data,aes(x=fjsturt,y=log(nuvirdi)))+
          geom_boxplot()

f3 <- ggplot(data,aes(x=fjbkar,y=log(nuvirdi)))+
          geom_boxplot()


f4 <- ggplot(data,aes(x=fjeld,y=log(nuvirdi)))+
          geom_boxplot()

f5 <- ggplot(data,aes(x=fjklos,y=log(nuvirdi)))+
          geom_boxplot()

f6 <- ggplot(data,aes(x=fjherb,y=log(nuvirdi)))+
          geom_boxplot()

f7 <- ggplot(data, aes(x=fjhaed,y=log(nuvirdi))) +
          geom_boxplot()

f8 <- ggplot(data, aes(x=fjstof,y=log(nuvirdi))) +
          geom_boxplot()

grid.arrange(f1,f2,
             f3,f4,
             f5,f6,
             f7,f8,ncol=3)
```


We also wan't to transform ibm2 to log scale as we can see from the plots below.
```{r}
corr1 <- ggplot(data,aes(x=ibm2,y=nuvirdi))+
                  geom_point()


corr2 <- ggplot(data,aes(x=ibm2,y=log(nuvirdi)))+
                  geom_point()


corr3 <- ggplot(data,aes(x=log(ibm2),y=log(nuvirdi)))+
                  geom_point()


grid.arrange(corr1,corr2,
             corr3,nrow=2)
```

log transforms

```{r}
data$nuvirdi = log(data$nuvirdi)
data$ibm2 = log(data$ibm2)
data$geymm2 = log(data$geymm2)
```

```{r}
ggplot(data,aes(x=ummal,y=nuvirdi))+
  geom_point()
```

byggar: ár byggt quantitative
fjmib: nr of apartments in the building. 1-4 quantitivative
fjhaed: number of floors in property, 1-4 quantitative
fjbilsk: number of garages, 0,1,2,3,4,8  quantitative.
fjbkar: number of bathtubs,0-3 quantitative
fjsturt: 0-4,7,12 quantitative: Factor 0,1,2
fjklos: 0-7,12 quantitative: Factor 0,1,2
fjeld: 0-4,7,12 quantitative: Factor 0,1,2
fjherb: 0-11,13,22,24 quantitative
fjstof: 0-7,11,14 quantitative
fjgeym: 0-8 quantitative
stig10: how far property is in construction stage quantitiative. 



